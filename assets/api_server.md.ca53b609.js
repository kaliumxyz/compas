import{_ as e,c as o,o as a,a as t}from"./app.d0d65fcc.js";const b='{"title":"@compas\\\\/server","description":"","frontmatter":{"editLink":false},"headers":[{"level":2,"title":"getApp","slug":"getapp"},{"level":2,"title":"sendFile","slug":"sendfile"},{"level":2,"title":"createBodyParsers","slug":"createbodyparsers"},{"level":2,"title":"session","slug":"session"},{"level":2,"title":"compose","slug":"compose"},{"level":2,"title":"createTestAppAndClient","slug":"createtestappandclient"},{"level":2,"title":"closeTestApp","slug":"closetestapp"}],"relativePath":"api/server.md","lastUpdated":1635769453828}',s={},p=t('<h1 id="compas-server" tabindex="-1">@compas/server <a class="header-anchor" href="#compas-server" aria-hidden="true">#</a></h1><div><h2 id="getapp" tabindex="-1">getApp <a class="header-anchor" href="#getapp" aria-hidden="true">#</a></h2><p><em>Available since 0.1.0</em></p><p><em>function getApp(opts?): void</em></p><p>Create a new Koa instance with default middleware applied.</p><p>Create a new Koa instance with default middleware applied. Adds the following: - Health check route on <code>/_health</code></p><ul><li><p>Log middleware to add the Logger from @compas/stdlib on <code>ctx.log</code></p></li><li><p>Error handler to catch any errors thrown by route handlers</p></li><li><p>A 404 handler when no response is set by other middleware</p></li><li><p>Default headers to respond to things like CORS requests</p></li></ul><p><strong>Parameters</strong>:</p><ul><li>opts <code>GetAppOptions={}</code></li></ul><p><em><a href="https://github.com/compasjs/compas/blob/main/packages/server/src/app.js#L77" target="_blank" rel="noopener noreferrer">source</a></em></p><h2 id="sendfile" tabindex="-1">sendFile <a class="header-anchor" href="#sendfile" aria-hidden="true">#</a></h2><p><em>Available since 0.1.0</em></p><p><em>function sendFile({import(&quot;koa&quot;).Context} ctx, file, getStreamFn): Promise&lt;void&gt;</em></p><p>Send a <code>StoreFile</code> instance from @compas/store as a <code>ctx</code> response. Handles byte range requests as well. May need some improvements to set some better cache headers.</p><p><strong>Parameters</strong>:</p><ul><li>{import(&quot;koa&quot;).Context} ctx <code>{import(&quot;koa&quot;).Context} ctx</code>: {import(&quot;koa&quot;).Context} ctx</li><li>file <code>StoreFile</code></li><li>getStreamFn <code>GetStreamFn</code></li></ul><p><em><a href="https://github.com/compasjs/compas/blob/main/packages/server/src/middleware/sendFile.js#L26" target="_blank" rel="noopener noreferrer">source</a></em></p><h2 id="createbodyparsers" tabindex="-1">createBodyParsers <a class="header-anchor" href="#createbodyparsers" aria-hidden="true">#</a></h2><p><em>Available since 0.1.0</em></p><p><em>function createBodyParsers(bodyOpts?, multipartBodyOpts?): BodyParserPair</em></p><p>Creates a body parser and a body parser with multipart enabled. Note that koa-body parses url-encoded, form data, json and text by default.</p><p><strong>Parameters</strong>:</p><ul><li>bodyOpts <code>KoaBodyOptions={}</code>: Options that will be passed to koa-body</li><li>multipartBodyOpts <code>formidable.Options={}</code>: Options that will be passed to formidable</li></ul><p><em><a href="https://github.com/compasjs/compas/blob/main/packages/server/src/middleware/body.js#L46" target="_blank" rel="noopener noreferrer">source</a></em></p><h2 id="session" tabindex="-1">session <a class="header-anchor" href="#session" aria-hidden="true">#</a></h2><p><em>Available since 0.1.0</em></p><p><em>function session({import(&quot;../app&quot;).KoaApplication} app, {Partial&lt;koaSession.opts &amp; { renew: number|boolean, keepPublicCookie?: boolean }&gt;} opts KoaSession options): Middleware</em></p><p>Session middleware. Requires process.<wbr>env.APP_KEYS to be set. To generate a key use something like: <code>node -e &quot;console.log(require(&#39;crypto&#39;).randomBytes(32).toString(&#39;base64&#39;))&quot;</code>. This also accepts the session store as provided by <code>@compas/store</code>.</p><p><strong>Parameters</strong>:</p><ul><li>{import(&quot;../app&quot;).KoaApplication} app <code>{import(&quot;../app&quot;).KoaApplication} app</code>: {import(&quot;../app&quot;).KoaApplication} app</li><li>{Partial&lt;koaSession.opts &amp; { renew: number|boolean, keepPublicCookie?: boolean }&gt;} opts KoaSession options <code>{Partial\\&lt;koaSession.opts &amp; { renew: number|boolean, keepPublicCookie?: boolean }&gt;} opts KoaSession options</code>: {Partial&lt;koaSession.opts &amp; { renew: number|boolean, keepPublicCookie?: boolean }&gt;} opts KoaSession options</li></ul><p><em><a href="https://github.com/compasjs/compas/blob/main/packages/server/src/middleware/session.js#L25" target="_blank" rel="noopener noreferrer">source</a></em></p><h2 id="compose" tabindex="-1">compose <a class="header-anchor" href="#compose" aria-hidden="true">#</a></h2><p><em>Available since 0.1.0</em></p><p><em>function compose({Middleware[]} middleware): Middleware</em></p><p>Compose <code>middleware</code> returning of all those which are passed.</p><p><strong>Parameters</strong>:</p><ul><li>{Middleware[]} middleware <code>{Middleware[]} middleware</code>: {Middleware[]} middleware</li></ul><p><em><a href="https://github.com/compasjs/compas/blob/main/packages/server/src/middleware/compose.js#L20" target="_blank" rel="noopener noreferrer">source</a></em></p><h2 id="createtestappandclient" tabindex="-1">createTestAppAndClient <a class="header-anchor" href="#createtestappandclient" aria-hidden="true">#</a></h2><p><em>Available since 0.1.0</em></p><p><em>function createTestAppAndClient({import(&quot;./app&quot;).KoaApplication} app, {import(&quot;axios&quot;).AxiosInstance} axios): Promise&lt;void&gt;</em></p><p>Open the provided Koa app on a random port, and use the port to set the &#39;baseURL&#39; on the provided Axios instance.</p><p><strong>Parameters</strong>:</p><ul><li>{import(&quot;./app&quot;).KoaApplication} app <code>{import(&quot;./app&quot;).KoaApplication} app</code>: {import(&quot;./app&quot;).KoaApplication} app</li><li>{import(&quot;axios&quot;).AxiosInstance} axios <code>{import(&quot;axios&quot;).AxiosInstance} axios</code>: {import(&quot;axios&quot;).AxiosInstance} axios</li></ul><p><em><a href="https://github.com/compasjs/compas/blob/main/packages/server/src/testing.js#L11" target="_blank" rel="noopener noreferrer">source</a></em></p><h2 id="closetestapp" tabindex="-1">closeTestApp <a class="header-anchor" href="#closetestapp" aria-hidden="true">#</a></h2><p><em>Available since 0.1.0</em></p><p><em>function closeTestApp({import(&quot;./app&quot;).KoaApplication} app): Promise&lt;void&gt;</em></p><p>Close the test app as created by <code>createTestAppAndClient</code>.</p><p><strong>Parameters</strong>:</p><ul><li>{import(&quot;./app&quot;).KoaApplication} app <code>{import(&quot;./app&quot;).KoaApplication} app</code>: {import(&quot;./app&quot;).KoaApplication} app</li></ul><p><em><a href="https://github.com/compasjs/compas/blob/main/packages/server/src/testing.js#L45" target="_blank" rel="noopener noreferrer">source</a></em></p></div>',2),r=[p];function i(n,l,d,c,m,u){return a(),o("div",null,r)}var g=e(s,[["render",i]]);export{b as __pageData,g as default};
