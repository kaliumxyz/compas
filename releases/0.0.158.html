<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Release notes v0.0.158 | Compas</title>
    <meta name="description" content="Unified backend tooling">
    <link rel="stylesheet" href="/assets/style.d82f6ee1.css">
    <link rel="modulepreload" href="/assets/Home.91b8674b.js">
    <link rel="modulepreload" href="/assets/app.d0d65fcc.js">
    <link rel="modulepreload" href="/assets/releases_0.0.158.md.1ee03062.lean.js">
    <link rel="modulepreload" href="/assets/app.d0d65fcc.js">
    <meta name="twitter:title" content="Release notes v0.0.158 | Compas">
    <meta property="og:title" content="Release notes v0.0.158 | Compas">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-675d8756><div class="sidebar-button" data-v-675d8756><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/" aria-label="Compas, back to home" data-v-675d8756 data-v-4a583abe><!----> Compas</a><div class="flex-grow" data-v-675d8756></div><div class="nav" data-v-675d8756><nav class="nav-links" data-v-675d8756 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/" data-v-b8818f8c>Docs <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/api/index.html" data-v-b8818f8c>API reference <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/changelog" data-v-b8818f8c>Changelog <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item active" href="/releases/index.html" data-v-b8818f8c>Release notes <!----></a></div></div><!--]--><!----><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/compasjs/compas" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-83e92a68><nav class="nav-links nav" data-v-83e92a68 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/" data-v-b8818f8c>Docs <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/api/index.html" data-v-b8818f8c>API reference <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/changelog" data-v-b8818f8c>Changelog <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item active" href="/releases/index.html" data-v-b8818f8c>Release notes <!----></a></div></div><!--]--><!----><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/compasjs/compas" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav><!--[--><!--]--><ul class="sidebar-links" data-v-83e92a68><!--[--><li class="sidebar-link"><a class="sidebar-link-item active" href="/releases/0.0.158.html">Release v0.0.158</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#cli">Cli</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#lint-config">Lint config</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#code-gen">Code gen</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#types">Types</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#validators">Validators</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#in-closing">In closing</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/releases/0.0.138.html">Release v0.0.138</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/releases/0.0.124.html">Release v0.0.124</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/releases/0.0.119.html">Release v0.0.119</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/releases/0.0.115.html">Release v0.0.115</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/releases/0.0.103.html">Release v0.0.103</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/releases/0.0.89.html">Release v0.0.89</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/releases/0.0.84.html">Release v0.0.84</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/releases/0.0.83.html">Release v0.0.83</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/releases/0.0.81.html">Release v0.0.81</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/releases/0.0.79.html">Release v0.0.79</a><!----></li><!--]--></ul><!--[--><!--]--></aside><!-- TODO: make this button accessible --><div class="sidebar-mask"></div><main class="page" data-v-7eddb2c4><div class="container" data-v-7eddb2c4><!--[--><!--]--><div style="position:relative;" class="content" data-v-7eddb2c4><div><h1 id="release-notes-v0-0-158" tabindex="-1">Release notes v0.0.158 <a class="header-anchor" href="#release-notes-v0-0-158" aria-hidden="true">#</a></h1><p>This release shifts the development experience for TS language server users (and sort of forces others to become one). As far as I know, <a href="https://github.com/compasjs/compas/pull/1055" target="_blank" rel="noopener noreferrer">this (#1055)</a> has been the longest open PR that got merged, and even has a predecessor, <a href="https://github.com/compasjs/compas/pull/461" target="_blank" rel="noopener noreferrer">#461</a>, back in November 2020. So let&#39;s get started.</p><h2 id="cli" tabindex="-1">Cli <a class="header-anchor" href="#cli" aria-hidden="true">#</a></h2><p>The Compas cli got a new command: <code>yarn compas init --jscconfig</code>. It (over)writes the <code>jsconfig.json</code> in the project directory. This file will become stricter over time, so keep it updated with Compas releases. This command and file is not necessary when only using the frontend code generators, because they imply an existing Typescript setup. To control the Typescript version used, you should add &#39;typescript&#39; as a &#39;devDependency&#39; in you project.</p><h2 id="lint-config" tabindex="-1">Lint config <a class="header-anchor" href="#lint-config" aria-hidden="true">#</a></h2><p>Since we are adding Typescript definition files to the project, disable automatic fixing of ESLint in your IDE for <code>.ts</code> and <code>.d.ts</code> files. This can be skipped if your ESLint config supports TypeScript files, the <code>@compas/lint-config</code> ones don&#39;t.</p><h2 id="code-gen" tabindex="-1">Code gen <a class="header-anchor" href="#code-gen" aria-hidden="true">#</a></h2><h3 id="types" tabindex="-1">Types <a class="header-anchor" href="#types" aria-hidden="true">#</a></h3><p>The first change in the code generators is that we now always create a <code>structure.js</code> file with the used generator options. This is used is &#39;multi-generate&#39; projects to combine all types in to a single <code>types.d.ts</code> file to avoid type conflicts down the road.</p><p>In a single generate project, e.g. only a single <code>app.generate</code> call, only a single addition is necessary. Add the following snippet after your <code>app.generate</code>:</p><div class="language-js"><pre><code><span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">generateTypes</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  outputDirectory<span class="token operator">:</span> <span class="token string">&quot;./types/generated&quot;</span><span class="token punctuation">,</span>
  inputPaths<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  dumpCompasTypes<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The <code>dumpCompasTypes</code> option tells Compas to create a type definition file that makes all major exported types from Compas global in the project. By doing it this way you don&#39;t have to import types like <code>App</code> like</p><div class="language-js"><pre><code><span class="token comment">/**
 * @typedef {import(&quot;@compas/stdlib&quot;).App} App
 */</span>
</code></pre></div><p>in your project.</p><p>In a multi generate project things are a bit more complicated. We have to prevent type conflicts of global types. To ensure this we use the <code>dumpStructure</code> option of <code>app.generate</code> and use <code>app.generateTypes</code> to combine all &#39;structures&#39; in to a single type definition file.</p><ul><li>Explicitly mention the <code>enabledGenerators</code> in each <code>app.generate</code> call, but don&#39;t add the <code>type</code> generator. When <code>type</code> is the only generator, <code>enabledGenerators</code> may be an empty array.</li><li>Add <code>dupmStructure: true</code> to each <code>app.generate</code> call.</li><li>Add the above <code>app.generateTypes</code> call, but in <code>inputPaths</code> specify each <code>outputDirectory</code> of your <code>app.generate</code> calls.</li></ul><p>This should give you a single type definition file specifying all necessary types.</p><h3 id="validators" tabindex="-1">Validators <a class="header-anchor" href="#validators" aria-hidden="true">#</a></h3><p>Another generator that got a big change is the validator generator. It now collects as many errors as possible before returning an <code>{ error }</code> or <code>{ value }</code> object. This is combined with a few breaking changes:</p><ul><li>No TypeScript file support anymore, so the <code>app.generate</code> call will throw if used in combination with <code>useTypescript: true</code>.</li><li>The <code>throwingValidator</code> option is removed, as validators will never throw but instead return an <code>{ error: AppError }</code> object if any validation error occurred.</li><li>The top-level error key is always <code>validator.error</code>. All other validation keys are now nested in the &#39;info&#39; object, with keys representing the &#39;property path&#39; and values containing the specific validation error and any information. A full example looks something like: <ul><li>Type definition:</li></ul><div class="language-js"><pre><code><span class="token keyword">const</span> <span class="token constant">T</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TypeCreator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> type <span class="token operator">=</span> <span class="token punctuation">{</span>
  foo<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">.</span><span class="token function">bool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  bar<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">.</span><span class="token function">anyOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">&quot;car&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">&quot;bicycle&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>Input:</li></ul><div class="language-json"><pre><code><span class="token punctuation">{</span>
  <span class="token property">&quot;bar&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;scooter&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>Resulting error:</li></ul><div class="language-json"><pre><code><span class="token punctuation">{</span>
  <span class="token property">&quot;key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;validator.error&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;info&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;$.foo&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;validation.boolean.undefined&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;info&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;$.bar&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;validator.anyOf&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;$.bar.type&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;validator.string.oneOf&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;info&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;oneOf&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;car&quot;</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;validator.string.oneOf&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;info&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;oneOf&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;bicycle&quot;</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul><p>Note that for <code>anyOf</code> validators the result may contain an array, since the property path may be the same.</p><h2 id="in-closing" tabindex="-1">In closing <a class="header-anchor" href="#in-closing" aria-hidden="true">#</a></h2><p>There is a bunch of improvements &amp; automation to be added, like auto generating documentation from the generated type definitions, writing tests for the type definitions and making the public api surface more strict by adding <code>@private</code> tags. But that&#39;s stuff for the future, for now I am back focussing on feature stability and some improvements &amp; additions to existing features.</p><p>As always please report missing type definitions and report bugs, thanks!</p></div></div><footer class="page-footer" data-v-7eddb2c4 data-v-fb8d84c6><div class="edit" data-v-fb8d84c6><div class="edit-link" data-v-fb8d84c6 data-v-1ed99556><a class="link" href="https://github.com/compasjs/compas/edit/main/docs/releases/0.0.158.md" target="_blank" rel="noopener noreferrer" data-v-1ed99556>Edit this page on GitHub <svg class="icon outbound icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-1ed99556><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="updated" data-v-fb8d84c6><p class="last-updated" data-v-fb8d84c6 data-v-5797b537><span class="prefix" data-v-5797b537>Last updated:</span><span class="datetime" data-v-5797b537></span></p></div></footer><div class="next-and-prev-link" data-v-7eddb2c4 data-v-38ede35f><div class="container" data-v-38ede35f><div class="prev" data-v-38ede35f><!----></div><div class="next" data-v-38ede35f><a class="link" href="/releases/0.0.138" data-v-38ede35f><span class="text" data-v-38ede35f>Release v0.0.138</span><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-next" data-v-38ede35f><path d="M19.9,12.4c0.1-0.2,0.1-0.5,0-0.8c-0.1-0.1-0.1-0.2-0.2-0.3l-7-7c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4l5.3,5.3H5c-0.6,0-1,0.4-1,1s0.4,1,1,1h11.6l-5.3,5.3c-0.4,0.4-0.4,1,0,1.4c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3l7-7C19.8,12.6,19.9,12.5,19.9,12.4z"></path></svg></a></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"api_cli.md\":\"4cdee5be\",\"api_index.md\":\"b616f6f7\",\"api_server.md\":\"ca53b609\",\"api_stdlib.md\":\"ac25692b\",\"api_store.md\":\"fde2dff1\",\"changelog.md\":\"04a687e3\",\"contributing.md\":\"5a423064\",\"features_background-jobs.md\":\"df72ea91\",\"features_code-gen-api-client.md\":\"852f438e\",\"features_code-gen-api.md\":\"32d48024\",\"features_code-gen-validators.md\":\"73965e4e\",\"features_http-server.md\":\"5ae90427\",\"features_lint-setup.md\":\"2a41a0d8\",\"features_logger-and-events.md\":\"e9bb9a2f\",\"features_migrations.md\":\"430beccb\",\"features_postgres-and-minio.md\":\"a83146c9\",\"features_script-runner.md\":\"c24efe5c\",\"features_session-handling.md\":\"2bd6d4d8\",\"features_test-and-bench-runner.md\":\"43c389fd\",\"features_typescript-setup.md\":\"e171d93a\",\"getting-started.md\":\"3b37bea7\",\"index.md\":\"7ea19361\",\"migrations_index.md\":\"6590fc91\",\"migrations_store.md\":\"048e3b5c\",\"releases_0.0.103.md\":\"da6ff15e\",\"releases_0.0.115.md\":\"fd875c62\",\"releases_0.0.119.md\":\"94b4c999\",\"releases_0.0.124.md\":\"8898f7a1\",\"releases_0.0.138.md\":\"cf0701c4\",\"releases_0.0.158.md\":\"1ee03062\",\"releases_0.0.79.md\":\"1db2024d\",\"releases_0.0.81.md\":\"dd7dc405\",\"releases_0.0.83.md\":\"20746784\",\"releases_0.0.84.md\":\"bb83711b\",\"releases_0.0.89.md\":\"7abc11e4\",\"releases_index.md\":\"93b24ebb\",\"todo.md\":\"b1cb77d2\"}")</script>
    <script type="module" async src="/assets/app.d0d65fcc.js"></script>
    
  </body>
</html>