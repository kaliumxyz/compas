<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>@compas\/store | Compas</title>
    <meta name="description" content="Unified backend tooling">
    <link rel="stylesheet" href="/assets/style.d82f6ee1.css">
    <link rel="modulepreload" href="/assets/Home.91b8674b.js">
    <link rel="modulepreload" href="/assets/app.d0d65fcc.js">
    <link rel="modulepreload" href="/assets/api_store.md.fde2dff1.lean.js">
    <link rel="modulepreload" href="/assets/app.d0d65fcc.js">
    <meta name="twitter:title" content="@compas\/store | Compas">
    <meta property="og:title" content="@compas\/store | Compas">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-675d8756><div class="sidebar-button" data-v-675d8756><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/" aria-label="Compas, back to home" data-v-675d8756 data-v-4a583abe><!----> Compas</a><div class="flex-grow" data-v-675d8756></div><div class="nav" data-v-675d8756><nav class="nav-links" data-v-675d8756 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/" data-v-b8818f8c>Docs <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item active" href="/api/index.html" data-v-b8818f8c>API reference <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/changelog" data-v-b8818f8c>Changelog <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/releases/index.html" data-v-b8818f8c>Release notes <!----></a></div></div><!--]--><!----><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/compasjs/compas" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-83e92a68><nav class="nav-links nav" data-v-83e92a68 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/" data-v-b8818f8c>Docs <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item active" href="/api/index.html" data-v-b8818f8c>API reference <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/changelog" data-v-b8818f8c>Changelog <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/releases/index.html" data-v-b8818f8c>Release notes <!----></a></div></div><!--]--><!----><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/compasjs/compas" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav><!--[--><!--]--><ul class="sidebar-links" data-v-83e92a68><!--[--><li class="sidebar-link"><a class="sidebar-link-item" href="/api/stdlib.html">@compas/stdlib</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/api/cli.html">@compas/cli</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item active" href="/api/store.html">@compas/store</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#newpostgresconnection">newPostgresConnection</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#setstorequeries">setStoreQueries</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#query">query</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#isquerypart">isQueryPart</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#stringifyquerypart">stringifyQueryPart</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#explainanalyzequery">explainAnalyzeQuery</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#newmigratecontext">newMigrateContext</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#getmigrationstobeapplied">getMigrationsToBeApplied</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#runmigrations">runMigrations</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#addeventtoqueue">addEventToQueue</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#addjobtoqueue">addJobToQueue</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#addrecurringjobtoqueue">addRecurringJobToQueue</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#addjobwithcustomtimeouttoqueue">addJobWithCustomTimeoutToQueue</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#getuncompletedjobsbyname">getUncompletedJobsByName</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#newsessionstore">newSessionStore</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#newminioclient">newMinioClient</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#ensurebucket">ensureBucket</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#removebucket">removeBucket</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#listobjects">listObjects</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#removebucketandobjectsinbucket">removeBucketAndObjectsInBucket</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#createorupdatefile">createOrUpdateFile</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#copyfile">copyFile</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#getfilestream">getFileStream</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#syncdeletedfiles">syncDeletedFiles</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#updatefilegrouporder">updateFileGroupOrder</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#createtestpostgresdatabase">createTestPostgresDatabase</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#cleanuptestpostgresdatabase">cleanupTestPostgresDatabase</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/api/server.html">@compas/server</a><!----></li><!--]--></ul><!--[--><!--]--></aside><!-- TODO: make this button accessible --><div class="sidebar-mask"></div><main class="page" data-v-7eddb2c4><div class="container" data-v-7eddb2c4><!--[--><!--]--><div style="position:relative;" class="content" data-v-7eddb2c4><div><h1 id="compas-store" tabindex="-1">@compas/store <a class="header-anchor" href="#compas-store" aria-hidden="true">#</a></h1><div><h2 id="newpostgresconnection" tabindex="-1">newPostgresConnection <a class="header-anchor" href="#newpostgresconnection" aria-hidden="true">#</a></h2><p><em>Available since 0.1.0</em></p><p><em>function newPostgresConnection({Postgres[&quot;connectionOptions&quot;]} [opts]): Promise&lt;Postgres&gt;</em></p><p>Create a new postgres connection, using the default environment variables. A database may be created using the provided credentials.</p><p><strong>Parameters</strong>:</p><ul><li>{Postgres[&quot;connectionOptions&quot;]} [opts] <code>{Postgres[&quot;connectionOptions&quot;]} [opts]</code>: {Postgres[&quot;connectionOptions&quot;]} [opts]</li></ul><p><em><a href="https://github.com/compasjs/compas/blob/main/packages/store/src/postgres.js#L48" target="_blank" rel="noopener noreferrer">source</a></em></p><h2 id="setstorequeries" tabindex="-1">setStoreQueries <a class="header-anchor" href="#setstorequeries" aria-hidden="true">#</a></h2><p><em>Available since 0.1.0</em></p><p><em>function setStoreQueries({typeof import(&quot;./generated/database/index.js&quot;).queries} q): void</em></p><p>Overwrite used generated queries. This is needed when you want cascading soft deletes to any of the exposed types. It is mandatory to be called if &#39;files&#39;, &#39;session&#39; or &#39;jobs&#39; are used. If you don&#39;t use the generators, you can use <code>storeQueries</code> as exported by <code>@compas/store</code>.</p><p><strong>Parameters</strong>:</p><ul><li>{typeof import(&quot;./generated/database/index.js&quot;).queries} q <code>{typeof import(&quot;./generated/database/index.js&quot;).queries} q</code>: {typeof import(&quot;./generated/database/index.js&quot;).queries} q</li></ul><p><em><a href="https://github.com/compasjs/compas/blob/main/packages/store/src/generated.js#L19" target="_blank" rel="noopener noreferrer">source</a></em></p><h2 id="query" tabindex="-1">query <a class="header-anchor" href="#query" aria-hidden="true">#</a></h2><p><em>Available since 0.1.0</em></p><p><em>function query({TemplateStringsArray | string[]} strings, {...(QueryPartArg | QueryPartArg[])} values): {import(&quot;../types/advanced-types&quot;).QueryPart&lt;T&gt;}</em></p><p>Format and append query parts, and execute the final result in a safe way. Undefined values are skipped, as they are not allowed in queries. The query call may be one of the interpolated values. Supports being called as a template literal.</p><p><strong>Parameters</strong>:</p><ul><li>{TemplateStringsArray | string[]} strings <code>{TemplateStringsArray | string[]} strings</code>: {TemplateStringsArray | string[]} strings</li><li>{...(QueryPartArg | QueryPartArg[])} values <code>{...(QueryPartArg | QueryPartArg[])} values</code>: {...(QueryPartArg | QueryPartArg[])} values</li></ul><p><em><a href="https://github.com/compasjs/compas/blob/main/packages/store/src/query.js#L27" target="_blank" rel="noopener noreferrer">source</a></em></p><h2 id="isquerypart" tabindex="-1">isQueryPart <a class="header-anchor" href="#isquerypart" aria-hidden="true">#</a></h2><p><em>Available since 0.1.0</em></p><p><em>function isQueryPart(query): {query is import(&quot;../types/advanced-types&quot;).QueryPart&lt;any&gt;}</em></p><p>Check if the passed in value is an object generated by &#39;query``&#39;.</p><p><strong>Parameters</strong>:</p><ul><li>query <code>any</code></li></ul><p><em><a href="https://github.com/compasjs/compas/blob/main/packages/store/src/query.js#L110" target="_blank" rel="noopener noreferrer">source</a></em></p><h2 id="stringifyquerypart" tabindex="-1">stringifyQueryPart <a class="header-anchor" href="#stringifyquerypart" aria-hidden="true">#</a></h2><p><em>Available since 0.1.0</em></p><p><em>function stringifyQueryPart({import(&quot;../types/advanced-types&quot;).QueryPart&lt;any&gt;} queryPart, options): {string|{ sql?: string, params?:[] }}</em></p><p>Stringify a queryPart. When interpolateParameters is true, we do a best effort in replacing the parameterized query with the real params. If the result doesn&#39;t look right, please turn it off.</p><p><strong>Parameters</strong>:</p><ul><li>{import(&quot;../types/advanced-types&quot;).QueryPart&lt;any&gt;} queryPart <code>{import(&quot;../types/advanced-types&quot;).QueryPart\&lt;any&gt;} queryPart</code>: {import(&quot;../types/advanced-types&quot;).QueryPart&lt;any&gt;} queryPart</li><li>options <code>{ interpolateParameters?: boolean }</code></li></ul><p><em><a href="https://github.com/compasjs/compas/blob/main/packages/store/src/query.js#L129" target="_blank" rel="noopener noreferrer">source</a></em></p><h2 id="explainanalyzequery" tabindex="-1">explainAnalyzeQuery <a class="header-anchor" href="#explainanalyzequery" aria-hidden="true">#</a></h2><p><em>Available since 0.1.0</em></p><p><em>function explainAnalyzeQuery(sql, {import(&quot;../types/advanced-types&quot;).QueryPart&lt;any&gt;} queryItem, options?): Promise&lt;string|object&gt;</em></p><p>Creates a transaction, executes the query, and rollback the transaction afterwards. This is safe to use with insert, update and delete queries. By default returns text, but can also return json. Note that explain output is highly depended on the current data and usage of the tables.</p><p><strong>Parameters</strong>:</p><ul><li>sql <code>Postgres</code></li><li>{import(&quot;../types/advanced-types&quot;).QueryPart&lt;any&gt;} queryItem <code>{import(&quot;../types/advanced-types&quot;).QueryPart\&lt;any&gt;} queryItem</code>: {import(&quot;../types/advanced-types&quot;).QueryPart&lt;any&gt;} queryItem</li><li>options <code>{ jsonResult?: boolean }={}</code></li></ul><p><em><a href="https://github.com/compasjs/compas/blob/main/packages/store/src/query.js#L181" target="_blank" rel="noopener noreferrer">source</a></em></p><h2 id="newmigratecontext" tabindex="-1">newMigrateContext <a class="header-anchor" href="#newmigratecontext" aria-hidden="true">#</a></h2><p><em>Available since 0.1.0</em></p><p><em>function newMigrateContext(sql, migrationDirectory): Promise&lt;MigrateContext&gt;</em></p><p>Create a new migration context, resolves all migrations and collects the current migration state.</p><p><strong>Parameters</strong>:</p><ul><li>sql <code>Postgres</code></li><li>migrationDirectory <code>string</code></li></ul><p><em><a href="https://github.com/compasjs/compas/blob/main/packages/store/src/migrations.js#L42" target="_blank" rel="noopener noreferrer">source</a></em></p><h2 id="getmigrationstobeapplied" tabindex="-1">getMigrationsToBeApplied <a class="header-anchor" href="#getmigrationstobeapplied" aria-hidden="true">#</a></h2><p><em>Available since 0.1.0</em></p><p>_function getMigrationsToBeApplied(mc): { migrationQueue: { name: string, number: number, repeatable: boolean _</p><p>Get the migrations to be applied from the provided migration context. Note that &#39;repeatable&#39; migrations are always in both the <code>migrationQueue</code> and <code>hashChanges</code>.</p><p><strong>Parameters</strong>:</p><ul><li>mc <code>MigrateContext</code></li></ul><p><em><a href="https://github.com/compasjs/compas/blob/main/packages/store/src/migrations.js#L111" target="_blank" rel="noopener noreferrer">source</a></em></p><h2 id="runmigrations" tabindex="-1">runMigrations <a class="header-anchor" href="#runmigrations" aria-hidden="true">#</a></h2><p><em>Available since 0.1.0</em></p><p><em>function runMigrations(mc): Promise&lt;void&gt;</em></p><p>Run the migrations currently pending in the migration context.</p><p><strong>Parameters</strong>:</p><ul><li>mc <code>MigrateContext</code></li></ul><p><em><a href="https://github.com/compasjs/compas/blob/main/packages/store/src/migrations.js#L142" target="_blank" rel="noopener noreferrer">source</a></em></p><h2 id="addeventtoqueue" tabindex="-1">addEventToQueue <a class="header-anchor" href="#addeventtoqueue" aria-hidden="true">#</a></h2><p><em>Available since 0.1.0</em></p><p><em>function addEventToQueue(sql, eventName, data): Promise&lt;number&gt;</em></p><p>Add an event to the job queue. Use this if the default priority is important, like sending the user an email to verify their email. Runs with priority &#39;2&#39;, the only higher priority values are priority &#39;0&#39; and &#39;1&#39;. Custom timeouts can&#39;t be described via this mechanism.</p><p><strong>Parameters</strong>:</p><ul><li>sql <code>Postgres</code></li><li>eventName <code>string</code></li><li>data <code>Record\&lt;string, any&gt;</code></li></ul><p><em><a href="https://github.com/compasjs/compas/blob/main/packages/store/src/queue.js#L447" target="_blank" rel="noopener noreferrer">source</a></em></p><h2 id="addjobtoqueue" tabindex="-1">addJobToQueue <a class="header-anchor" href="#addjobtoqueue" aria-hidden="true">#</a></h2><p><em>Available since 0.1.0</em></p><p><em>function addJobToQueue(sql, job): Promise&lt;number&gt;</em></p><p>Add a new job to the queue. Use this for normal jobs or to customize the job priority. The default priority is &#39;5&#39;.</p><p><strong>Parameters</strong>:</p><ul><li>sql <code>Postgres</code></li><li>job <code>JobInput</code></li></ul><p><em><a href="https://github.com/compasjs/compas/blob/main/packages/store/src/queue.js#L469" target="_blank" rel="noopener noreferrer">source</a></em></p><h2 id="addrecurringjobtoqueue" tabindex="-1">addRecurringJobToQueue <a class="header-anchor" href="#addrecurringjobtoqueue" aria-hidden="true">#</a></h2><p><em>Available since 0.1.0</em></p><p><em>function addRecurringJobToQueue(sql, job): Promise&lt;void&gt;</em></p><p>Add a recurring job, if no existing job with the same name is scheduled. Does not throw when a job is already pending with the same name. If exists will update the interval. The default priority is &#39;4&#39;, which is a bit more important than other jobs.</p><p><strong>Parameters</strong>:</p><ul><li>sql <code>Postgres</code></li><li>job <code>{ name: string, priority?: number|undefined, interval: StoreJobInterval }</code></li></ul><p><em><a href="https://github.com/compasjs/compas/blob/main/packages/store/src/queue.js#L540" target="_blank" rel="noopener noreferrer">source</a></em></p><h2 id="addjobwithcustomtimeouttoqueue" tabindex="-1">addJobWithCustomTimeoutToQueue <a class="header-anchor" href="#addjobwithcustomtimeouttoqueue" aria-hidden="true">#</a></h2><p><em>Available since 0.1.0</em></p><p><em>function addJobWithCustomTimeoutToQueue(sql, job, timeout): Promise&lt;number&gt;</em></p><p>Add a new job to the queue. Use this for normal jobs or to customize the job priority. The default priority is &#39;5&#39;. The timeout value must be an integer higher than 10. The timeout value represents the number of milliseconds the handler may run, before the &#39;InsightEvent&#39; is aborted.</p><p><strong>Parameters</strong>:</p><ul><li>sql <code>Postgres</code></li><li>job <code>JobInput</code></li><li>timeout <code>number</code></li></ul><p><em><a href="https://github.com/compasjs/compas/blob/main/packages/store/src/queue.js#L502" target="_blank" rel="noopener noreferrer">source</a></em></p><h2 id="getuncompletedjobsbyname" tabindex="-1">getUncompletedJobsByName <a class="header-anchor" href="#getuncompletedjobsbyname" aria-hidden="true">#</a></h2><p><em>Available since undefined</em></p><p><em>function getUncompletedJobsByName(sql): {Promise&lt;Object&lt;string, QueryResultStoreJob[]&gt;&gt;}</em></p><p>Get all uncompleted jobs from the queue. Useful for testing if jobs are created.</p><p><strong>Parameters</strong>:</p><ul><li>sql <code>Postgres</code></li></ul><p><em><a href="https://github.com/compasjs/compas/blob/main/packages/store/src/queue.js#L647" target="_blank" rel="noopener noreferrer">source</a></em></p><h2 id="newsessionstore" tabindex="-1">newSessionStore <a class="header-anchor" href="#newsessionstore" aria-hidden="true">#</a></h2><p><em>Available since 0.1.0</em></p><p><em>function newSessionStore({import(&quot;../types/advanced-types&quot;).Postgres} sql): SessionStore</em></p><p>Create a new session store, to be used in combination with the <code>session</code> as provided in <code>@compas/server</code>.</p><p><strong>Parameters</strong>:</p><ul><li>{import(&quot;../types/advanced-types&quot;).Postgres} sql <code>{import(&quot;../types/advanced-types&quot;).Postgres} sql</code>: {import(&quot;../types/advanced-types&quot;).Postgres} sql</li></ul><p><em><a href="https://github.com/compasjs/compas/blob/main/packages/store/src/sessions.js#L54" target="_blank" rel="noopener noreferrer">source</a></em></p><h2 id="newminioclient" tabindex="-1">newMinioClient <a class="header-anchor" href="#newminioclient" aria-hidden="true">#</a></h2><p><em>Available since 0.1.0</em></p><p><em>function newMinioClient(opts): MinioClient</em></p><p>Create a minio client with the default environment variables as defaults. Minio is an S3 compatible client, so can be used against any S3 compatible interface.</p><p><strong>Parameters</strong>:</p><ul><li>opts <code>minio.ClientOptions</code></li></ul><p><em><a href="https://github.com/compasjs/compas/blob/main/packages/store/src/minio.js#L17" target="_blank" rel="noopener noreferrer">source</a></em></p><h2 id="ensurebucket" tabindex="-1">ensureBucket <a class="header-anchor" href="#ensurebucket" aria-hidden="true">#</a></h2><p><em>Available since 0.1.0</em></p><p><em>function ensureBucket(minio, bucketName, region): Promise&lt;void&gt;</em></p><p>Make sure a bucket exists and if it doesn&#39;t create it.</p><p><strong>Parameters</strong>:</p><ul><li>minio <code>MinioClient</code></li><li>bucketName <code>string</code></li><li>region <code>string</code></li></ul><p><em><a href="https://github.com/compasjs/compas/blob/main/packages/store/src/minio.js#L42" target="_blank" rel="noopener noreferrer">source</a></em></p><h2 id="removebucket" tabindex="-1">removeBucket <a class="header-anchor" href="#removebucket" aria-hidden="true">#</a></h2><p><em>Available since 0.1.0</em></p><p><em>function removeBucket(minio, bucketName): Promise&lt;void&gt;</em></p><p>Remove the provided bucket name. Note that this will fail if a bucket has objects.</p><p><strong>Parameters</strong>:</p><ul><li>minio <code>MinioClient</code></li><li>bucketName <code>string</code></li></ul><p><em><a href="https://github.com/compasjs/compas/blob/main/packages/store/src/minio.js#L82" target="_blank" rel="noopener noreferrer">source</a></em></p><h2 id="listobjects" tabindex="-1">listObjects <a class="header-anchor" href="#listobjects" aria-hidden="true">#</a></h2><p><em>Available since 0.1.0</em></p><p><em>function listObjects(minio, bucketName, filter?): Promise&lt;{name: string, prefix: string, size: number, etag: string, lastModified: Date</em></p><p>List all objects in a bucket.</p><p><strong>Parameters</strong>:</p><ul><li>minio <code>MinioClient</code></li><li>bucketName <code>string</code></li><li>filter <code>string?</code></li></ul><p><em><a href="https://github.com/compasjs/compas/blob/main/packages/store/src/minio.js#L60" target="_blank" rel="noopener noreferrer">source</a></em></p><h2 id="removebucketandobjectsinbucket" tabindex="-1">removeBucketAndObjectsInBucket <a class="header-anchor" href="#removebucketandobjectsinbucket" aria-hidden="true">#</a></h2><p><em>Available since 0.1.0</em></p><p><em>function removeBucketAndObjectsInBucket(minio, bucketName): Promise&lt;void&gt;</em></p><p>Force removal of a bucket by listing and removing it&#39;s objects.</p><p><strong>Parameters</strong>:</p><ul><li>minio <code>MinioClient</code></li><li>bucketName <code>string</code></li></ul><p><em><a href="https://github.com/compasjs/compas/blob/main/packages/store/src/minio.js#L95" target="_blank" rel="noopener noreferrer">source</a></em></p><h2 id="createorupdatefile" tabindex="-1">createOrUpdateFile <a class="header-anchor" href="#createorupdatefile" aria-hidden="true">#</a></h2><p><em>Available since 0.1.0</em></p><p><em>function createOrUpdateFile(sql, minio, bucketName, {{ id?: undefined | string; contentLength?: number; bucketName?: string; contentType: string; name: string; meta?: | undefined | { transforms?: undefined | any; transformedFromOriginal?: undefined | string; } | object; createdAt?: undefined | Date; updatedAt?: undefined | Date; deletedAt?: undefined | Date; }} props, source): Promise&lt;StoreFile&gt;</em></p><p>Create or update a file. The file store is backed by a Postgres table and S3 object.</p><p><strong>Parameters</strong>:</p><ul><li>sql <code>Postgres</code></li><li>minio <code>MinioClient</code></li><li>bucketName <code>string</code></li><li>{{ id?: undefined | string; contentLength?: number; bucketName?: string; contentType: string; name: string; meta?: | undefined | { transforms?: undefined | any; transformedFromOriginal?: undefined | string; } | object; createdAt?: undefined | Date; updatedAt?: undefined | Date; deletedAt?: undefined | Date; }} props <code>{{ id?: undefined | string; contentLength?: number; bucketName?: string; contentType: string; name: string; meta?: | undefined | { transforms?: undefined | any; transformedFromOriginal?: undefined | string; } | object; createdAt?: undefined | Date; updatedAt?: undefined | Date; deletedAt?: undefined | Date; }} props</code>: {{ id?: undefined | string; contentLength?: number; bucketName?: string; contentType: string; name: string; meta?: | undefined | { transforms?: undefined | any; transformedFromOriginal?: undefined | string; } | object; createdAt?: undefined | Date; updatedAt?: undefined | Date; deletedAt?: undefined | Date; }} props</li><li>source <code>NodeJS.ReadableStream|string|Buffer</code></li></ul><p><em><a href="https://github.com/compasjs/compas/blob/main/packages/store/src/files.js#L61" target="_blank" rel="noopener noreferrer">source</a></em></p><h2 id="copyfile" tabindex="-1">copyFile <a class="header-anchor" href="#copyfile" aria-hidden="true">#</a></h2><p><em>Available since 0.1.0</em></p><p><em>function copyFile(sql, minio, bucketName, id, targetBucket?): Promise&lt;StoreFile&gt;</em></p><p>Create both a Postgres record copy and an S3 object copy of the provided file id, into the provided bucket.</p><p><strong>Parameters</strong>:</p><ul><li>sql <code>Postgres</code></li><li>minio <code>MinioClient</code></li><li>bucketName <code>string</code></li><li>id <code>string</code></li><li>targetBucket <code>string=bucketName</code></li></ul><p><em><a href="https://github.com/compasjs/compas/blob/main/packages/store/src/files.js#L145" target="_blank" rel="noopener noreferrer">source</a></em></p><h2 id="getfilestream" tabindex="-1">getFileStream <a class="header-anchor" href="#getfilestream" aria-hidden="true">#</a></h2><p><em>Available since 0.1.0</em></p><p><em>function getFileStream(minio, bucketName, id, seek?): Promise&lt;NodeJS.ReadableStream&gt;</em></p><p>Get a file stream based on the &#39;id&#39;. It is expected that an object exists with the &#39;id&#39;. A &#39;start&#39; and &#39;end&#39; value can optionally be specified.</p><p><strong>Parameters</strong>:</p><ul><li>minio <code>MinioClient</code></li><li>bucketName <code>string</code></li><li>id <code>string</code></li><li>seek <code>{ start?: number|undefined, end?: number|undefined }={}</code></li></ul><p><em><a href="https://github.com/compasjs/compas/blob/main/packages/store/src/files.js#L117" target="_blank" rel="noopener noreferrer">source</a></em></p><h2 id="syncdeletedfiles" tabindex="-1">syncDeletedFiles <a class="header-anchor" href="#syncdeletedfiles" aria-hidden="true">#</a></h2><p><em>Available since 0.1.0</em></p><p><em>function syncDeletedFiles(sql, minio, bucketName): Promise&lt;number&gt;</em></p><p>File deletes should be done via <code>queries.storeFileDeletePermanent()</code>. By calling this function, all files that don&#39;t exist in the database will be removed from the S3 bucket.</p><p><strong>Parameters</strong>:</p><ul><li>sql <code>Postgres</code></li><li>minio <code>MinioClient</code></li><li>bucketName <code>string</code></li></ul><p><em><a href="https://github.com/compasjs/compas/blob/main/packages/store/src/files.js#L184" target="_blank" rel="noopener noreferrer">source</a></em></p><h2 id="updatefilegrouporder" tabindex="-1">updateFileGroupOrder <a class="header-anchor" href="#updatefilegrouporder" aria-hidden="true">#</a></h2><p><em>Available since 0.1.0</em></p><p><em>function updateFileGroupOrder(sql, {string[]} ids): Promise&lt;void&gt;</em></p><p>Update the order of the provided id&#39;s in relation to each other. This function does not check if all files are in the same group, please use getFileGroupParents for that.</p><p><strong>Parameters</strong>:</p><ul><li>sql <code>Postgres</code></li><li>{string[]} ids <code>{string[]} ids</code>: {string[]} ids</li></ul><p><em><a href="https://github.com/compasjs/compas/blob/main/packages/store/src/file-group.js#L59" target="_blank" rel="noopener noreferrer">source</a></em></p><h2 id="createtestpostgresdatabase" tabindex="-1">createTestPostgresDatabase <a class="header-anchor" href="#createtestpostgresdatabase" aria-hidden="true">#</a></h2><p><em>Available since 0.1.0</em></p><p><em>function createTestPostgresDatabase(verboseSql?, {Postgres[&quot;connectionOptions&quot;]} [rawOpts]): Promise&lt;Postgres&gt;</em></p><p>Create a new test database, using the default database as it&#39;s template. The copied database will be fully truncated, except for the &#39;migrations&#39; table. To do this, all connections to the default database are forcefully killed. Returns a connection to the new database.</p><p><strong>Parameters</strong>:</p><ul><li>verboseSql <code>boolean=false</code>: If true, creates a new logger and prints all queries.</li><li>{Postgres[&quot;connectionOptions&quot;]} [rawOpts] <code>{Postgres[&quot;connectionOptions&quot;]} [rawOpts]</code>: {Postgres[&quot;connectionOptions&quot;]} [rawOpts]</li></ul><p><em><a href="https://github.com/compasjs/compas/blob/main/packages/store/src/testing.js#L68" target="_blank" rel="noopener noreferrer">source</a></em></p><h2 id="cleanuptestpostgresdatabase" tabindex="-1">cleanupTestPostgresDatabase <a class="header-anchor" href="#cleanuptestpostgresdatabase" aria-hidden="true">#</a></h2><p><em>Available since 0.1.0</em></p><p><em>function cleanupTestPostgresDatabase(sql): Promise&lt;void&gt;</em></p><p>Try to remove a test database. Can only happen if the connection is created by &#39;createTestPostgresDatabase&#39;.</p><p><strong>Parameters</strong>:</p><ul><li>sql <code>Postgres</code></li></ul><p><em><a href="https://github.com/compasjs/compas/blob/main/packages/store/src/testing.js#L160" target="_blank" rel="noopener noreferrer">source</a></em></p></div></div></div><footer class="page-footer" data-v-7eddb2c4 data-v-fb8d84c6><div class="edit" data-v-fb8d84c6><div class="edit-link" data-v-fb8d84c6 data-v-1ed99556><!----></div></div><div class="updated" data-v-fb8d84c6><p class="last-updated" data-v-fb8d84c6 data-v-5797b537><span class="prefix" data-v-5797b537>Last updated:</span><span class="datetime" data-v-5797b537></span></p></div></footer><div class="next-and-prev-link" data-v-7eddb2c4 data-v-38ede35f><div class="container" data-v-38ede35f><div class="prev" data-v-38ede35f><a class="link" href="/api/cli" data-v-38ede35f><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-38ede35f><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-38ede35f>@compas/cli</span></a></div><div class="next" data-v-38ede35f><a class="link" href="/api/server" data-v-38ede35f><span class="text" data-v-38ede35f>@compas/server</span><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-next" data-v-38ede35f><path d="M19.9,12.4c0.1-0.2,0.1-0.5,0-0.8c-0.1-0.1-0.1-0.2-0.2-0.3l-7-7c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4l5.3,5.3H5c-0.6,0-1,0.4-1,1s0.4,1,1,1h11.6l-5.3,5.3c-0.4,0.4-0.4,1,0,1.4c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3l7-7C19.8,12.6,19.9,12.5,19.9,12.4z"></path></svg></a></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"api_cli.md\":\"4cdee5be\",\"api_index.md\":\"b616f6f7\",\"api_server.md\":\"ca53b609\",\"api_stdlib.md\":\"ac25692b\",\"api_store.md\":\"fde2dff1\",\"changelog.md\":\"04a687e3\",\"contributing.md\":\"5a423064\",\"features_background-jobs.md\":\"df72ea91\",\"features_code-gen-api-client.md\":\"852f438e\",\"features_code-gen-api.md\":\"32d48024\",\"features_code-gen-validators.md\":\"73965e4e\",\"features_http-server.md\":\"5ae90427\",\"features_lint-setup.md\":\"2a41a0d8\",\"features_logger-and-events.md\":\"e9bb9a2f\",\"features_migrations.md\":\"430beccb\",\"features_postgres-and-minio.md\":\"a83146c9\",\"features_script-runner.md\":\"c24efe5c\",\"features_session-handling.md\":\"2bd6d4d8\",\"features_test-and-bench-runner.md\":\"43c389fd\",\"features_typescript-setup.md\":\"e171d93a\",\"getting-started.md\":\"3b37bea7\",\"index.md\":\"7ea19361\",\"migrations_index.md\":\"6590fc91\",\"migrations_store.md\":\"048e3b5c\",\"releases_0.0.103.md\":\"da6ff15e\",\"releases_0.0.115.md\":\"fd875c62\",\"releases_0.0.119.md\":\"94b4c999\",\"releases_0.0.124.md\":\"8898f7a1\",\"releases_0.0.138.md\":\"cf0701c4\",\"releases_0.0.158.md\":\"1ee03062\",\"releases_0.0.79.md\":\"1db2024d\",\"releases_0.0.81.md\":\"dd7dc405\",\"releases_0.0.83.md\":\"20746784\",\"releases_0.0.84.md\":\"bb83711b\",\"releases_0.0.89.md\":\"7abc11e4\",\"releases_index.md\":\"93b24ebb\",\"todo.md\":\"b1cb77d2\"}")</script>
    <script type="module" async src="/assets/app.d0d65fcc.js"></script>
    
  </body>
</html>